var App=function(){var a,b,c={},d="http://thisisunfinished.com/cmm/",e="",f="",g="",h=!1,i=0,j=!1,k={},l=!1,m=!1,n=0,o=[],p=0,q=[{},{fnBeforeShow:function(){c.navEnable()}},{fnBeforeShow:function(){c.navEnable()}},{fnBeforeShow:function(){c.navDisable(),$('div[data-slide="3"]').on("click",q[3].fnSlideClick)},fnAfterLeave:function(){$('div[data-slide="3"]').off("click",q[3].fnSlideClick),$('div[data-slide="3"] > *').removeClass("shown")},fnAfterShow:function(){var a=$('div[data-slide="3"]').children();p=0,o.push(setTimeout(function(){$(a[0]).addClass("shown"),p++},0)),o.push(setTimeout(function(){$(a[1]).addClass("shown"),p++},3e3)),o.push(setTimeout(function(){c.navEnable(),$(a[2]).addClass("shown"),p++},6e3))},fnSlideClick:function(){var a=$('div[data-slide="3"]').children().addClass("shown");if(c.navEnable(),$(a[p]).addClass("shown"),o.length>0){for(var b=0;b<o.length;b++)window.clearTimeout(o[b]);o=[]}}},{fnBeforeShow:function(){c.navDisable(),$('div[data-slide="4"]').on("click",q[4].fnSlideClick)},fnAfterLeave:function(){$('div[data-slide="4"]').off("click",q[4].fnSlideClick),$('div[data-slide="4"] > *').removeClass("shown")},fnAfterShow:function(){var a=$('div[data-slide="4"]').children();p=0,o.push(setTimeout(function(){$(a[0]).addClass("shown"),p++},0)),o.push(setTimeout(function(){$(a[1]).addClass("shown"),p++},1e3)),o.push(setTimeout(function(){$(a[2]).addClass("shown"),p++},2e3)),o.push(setTimeout(function(){c.navEnable(),$(a[3]).addClass("shown"),p++},3e3))},fnSlideClick:function(){var a=$('div[data-slide="4"]').children().addClass("shown");if(c.navEnable(),$(a[p]).addClass("shown"),o.length>0){for(var b=0;b<o.length;b++)window.clearTimeout(o[b]);o=[]}}},{fnBeforeShow:function(){c.navEnable()}},{},{},{},{},{fnBeforeShow:function(){c.navDisable(),$('div[data-slide="10"]').on("click",q[10].fnSlideClick)},fnAfterLeave:function(){$('div[data-slide="10"]').off("click",q[10].fnSlideClick),$('div[data-slide="10"] > *').removeClass("shown")},fnAfterShow:function(){var a=$('div[data-slide="10"]').children();p=0,o.push(setTimeout(function(){$(a[0]).addClass("shown"),p++},0)),o.push(setTimeout(function(){$(a[1]).addClass("shown"),p++},3e3)),o.push(setTimeout(function(){$(a[2]).addClass("shown"),p++},7e3)),o.push(setTimeout(function(){c.navEnable(),$(a[3]).addClass("shown"),p++},1e4))},fnSlideClick:function(){var a=$('div[data-slide="10"]').children().addClass("shown");if(c.navEnable(),$(a[p]).addClass("shown"),o.length>0){for(var b=0;b<o.length;b++)window.clearTimeout(o[b]);o=[]}}},{fnBeforeShow:function(){c.navDisable(),$('div[data-slide="11"]').on("click",q[11].fnSlideClick)},fnAfterLeave:function(){$('div[data-slide="11"]').off("click",q[11].fnSlideClick),$('div[data-slide="11"] > *').removeClass("shown")},fnAfterShow:function(){var a=$('div[data-slide="11"]').children();p=0,o.push(setTimeout(function(){$(a[0]).addClass("shown"),p++},0)),o.push(setTimeout(function(){c.navEnable(),$(a[1]).addClass("shown"),p++},3e3))},fnSlideClick:function(){var a=$('div[data-slide="11"]').children().addClass("shown");if(c.navEnable(),$(a[p]).addClass("shown"),o.length>0){for(var b=0;b<o.length;b++)window.clearTimeout(o[b]);o=[]}}},{fnBeforeShow:function(){c.navEnable()}},{},{fnBeforeShow:function(){window.mySwiper.lockSwipeToNext(),$(".button-next").addClass("disabled")},fnAfterLeave:function(){$(".button-next").removeClass("disabled")}},{fnBeforeShow:function(){window.plugins.insomnia.keepAwake(),c.navDisable()},fnAfterLeave:function(){window.plugins.insomnia.allowSleepAgain()}},{fnBeforeShow:function(){$(".form-submit").removeAttr("disabled"),$(".form-submit").html("Submit"),c.navDisable()}},{fnBeforeShow:function(){c.navDisable()},fnAfterLeave:function(){c.navEnable(),window.mySwiper.lockSwipeToPrev(),$(".button-prev").addClass("disabled")}},{fnAfterLeave:function(){$(".button-prev").removeClass("disabled")},fnBeforeShow:function(){$("#detailsForm")[0].reset(),window.mySwiper.lockSwipeToPrev(),$(".button-prev").addClass("disabled")}},{fnBeforeShow:function(){window.mySwiper.unlockSwipeToPrev()}}];return c.reset=function(){a.release(),e="",f="",g="",h=!1,i=0,j=!1,k={},l=!1,m=!1,n=0,o=[],p=0,c.navEnable(),window.mySwiper.slideTo(0)},c.init=function(){this.bindEvents(),$("#detailsForm").validate({submitHandler:function(a){f=$(a).serialize(),j?c.dataFinished():(l=!0,$(".form-row").hide(),$(".loading-row").show(),$(".loading-row").parent().removeClass("top"))}}),window.mySwiper=new Swiper(".swiper-container",{direction:"horizontal",loop:!1,speed:900,nextButton:".button-next",prevButton:".button-prev",onlyExternal:!0,onSlideChangeStart:function(a){if(p=0,o.length>0){for(var b=0;b<o.length;b++)window.clearTimeout(o[b]);o=[]}var c=window.mySwiper.activeIndex;"undefined"!=typeof q[c]&&"undefined"!=typeof q[c].fnBeforeShow&&q[c].fnBeforeShow()},onSlideChangeEnd:function(){var a=window.mySwiper.activeIndex;"undefined"!=typeof q[a]&&"undefined"!=typeof q[a].fnAfterShow&&q[a].fnAfterShow();var b=window.mySwiper.previousIndex;"undefined"!=typeof q[b]&&"undefined"!=typeof q[b].fnAfterLeave&&q[b].fnAfterLeave()}}),c.navDisable(),$(".fake-record").on("click",function(){c.navEnable(),window.mySwiper.slideNext(),c.navDisable(),$(".record").trigger("click")}),$(".record").on("click",function(){h||m?h&&m?(m=!1,$(".record").html('<i class="fa fa-pause"></i> Pause'),$(".fa-microphone, .recording-light, .recording-text").addClass("recording"),c.resumeRecording()):(m=!0,c.pauseRecording(),$(".fa-microphone, .recording-light, .recording-text").removeClass("recording"),$(".record").html('<i class="fa fa-play"></i> Resume')):(c.startRecording(),h=!0,$(".fa-microphone, .recording-light, .recording-text").addClass("recording"),$(".record").html('<i class="fa fa-pause"></i> Pause'))}),$(".send").on("click",function(){$(".upload-panel").toggleClass("show"),setTimeout(function(){c.uploadRecording()},500),c.navEnable(),window.mySwiper.slideNext(),c.navDisable()}),$(".stop").on("click",function(){return h?(c.stopRecording(),$(".fa-microphone, .recording-light, .recording-text").removeClass("recording"),h=!1,m=!1,$(".confirm-panel").addClass("show"),void 0):!1}),$(".continue").on("click",function(){$(".confirm-panel").removeClass("show"),setTimeout(function(){c.navEnable(),window.mySwiper.slideNext(),c.navDisable()},700)}),$(".try-again").on("click",function(){h=!1,m=!1,a.release(),$(".confirm-panel").removeClass("show"),setTimeout(function(){c.navEnable(),c.previousSlide(),c.navDisable()},700)}),$(".restart").on("click",function(){$("#detailsForm")[0].reset(),c.navEnable(),window.mySwiper.slideTo(0)}),$(".delete").on("click",function(){c.navEnable(),window.mySwiper.slideTo(19),c.navDisable()}),$(".play").on("click",function(){c.playAudio()}),$(".start").on("click",function(){c.navEnable(),c.nextSlide()})},c.dataFinished=function(){$(".form-submit").html('<i class="fa fa-spinner fa-pulse"></i> Submit'),$(".form-submit").attr("disabled","disabled");var a;a="undefined"==typeof k||"undefined"==typeof k.uuid?"test":k.uuid,f+="&uuid="+encodeURIComponent(a),$.ajax({type:"POST",data:f,url:d+"form.php",success:function(a){c.navEnable(),window.mySwiper.slideTo(18),c.navDisable()},error:function(a){alert("There was an error uploading your data. Please try again."),$(".form-submit").removeAttr("disabled"),$(".form-submit").html("Submit")},timeout:1e4})},c.bindEvents=function(){document.addEventListener("deviceready",this.onDeviceReady,!1),$(".privacy-text").on("click",function(){$(".privacy-panel").addClass("show")}),$(".privacy-ok").on("click",function(){$(".privacy-panel").removeClass("show")})},c.onDeviceReady=function(){navigator.splashscreen.hide(),document.addEventListener("resume",function(){setTimeout(function(){var a=document.getElementById("bg");a.play()},0)}),$(function(){FastClick.attach(document.body)})},c.navDisable=function(){$(".nav").addClass("swiper-button-disabled"),window.mySwiper.lockSwipes()},c.navEnable=function(){$(".nav").removeClass("swiper-button-disabled"),window.mySwiper.unlockSwipes()},c.nextSlide=function(){window.mySwiper.slideNext()},c.previousSlide=function(){window.mySwiper.slidePrev()},c.getMedia=function(){return a},c.startRecording=function(){return h!==!1?!1:(i=0,h=!0,e="myrecording.m4a",a=new Media(e,c.recordSuccess,c.error),a.startRecord(),b=setInterval(function(){c.setAudioPosition(i),i++},1e3),void 0)},c.pauseRecording=function(){clearInterval(b),a.pauseRecord()},c.resumeRecording=function(){a.resumeRecord(),b=setInterval(function(){c.setAudioPosition(i),i++},1e3)},c.stopRecording=function(){return h!==!0?!1:(a.stopRecord(),clearInterval(b),h=!1,void 0)},c.playAudio=function(){a.play(),b=setInterval(function(){a.getCurrentPosition(function(a){a>-1&&c.setAudioPosition(a)},function(a){alert("Error getting pos="+a)})},1e3)},c.recordSuccess=function(){},c.error=function(a){alert("code: "+a.code+"\nmessage: "+a.message+"\n")},c.setAudioPosition=function(a){var b=moment().startOf("day").seconds(a).format("mm:ss");document.getElementById("counter").innerHTML=b},c.uploadRecording=function(){window.requestFileSystem(LocalFileSystem.TEMPORARY,0,function(a){a.root.getFile(e,{create:!0,exclusive:!1},function(a){g=a.toURL();var b=encodeURI(d+"audio.php"),f=new FileUploadOptions;f.fileKey="file",f.fileName=e,f.mimeType="audio/m4a";var h=new FileTransfer;h.onprogress=function(a){if(a.lengthComputable){var b=Math.floor(a.loaded/a.total*100);$(".progress-bar").css("width",b+"%").attr("aria-valuenow",b)}else $(".progress-bar").css("width","0%").attr("aria-valuenow","0")},h.upload(g,b,c.uploadSuccess,c.RecordError,f)},c.error)},c.error)},c.uploadSuccess=function(a){j=!0,k=JSON.parse(a.response),$(".upload-panel").removeClass("show"),l&&c.dataFinished()},c};